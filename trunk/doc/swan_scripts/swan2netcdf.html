<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of swan2netcdf</title>
  <meta name="keywords" content="swan2netcdf">
  <meta name="description" content="Convert a SWAN output file (Matlab) into a NetCDF file">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">swan_scripts</a> &gt; swan2netcdf.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for swan_scripts&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>swan2netcdf
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Convert a SWAN output file (Matlab) into a NetCDF file</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function swan2netcdf(matfile,ncfile,basename,first_time,last_time,increment); </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Convert a SWAN output file (Matlab) into a NetCDF file

 function swan2netcdf(matfile,ncfile,basename,first_time,last_time,increment);

 DESCRIPTION:
    read output from unstructured SWAN model (currently 40.82) and
    dump to a NetCDF file which is far more useful than a Matlab file.

 INPUT
   matfile  = Unstructured SWAN Matlab file
   ncfile   = NetCDF file for output
   basename = prefix for SWAN mesh, bathymetry, connectivity files
   first_time:  first time frame in Matlab object frame time
   last_time:   last time frame in Matlab object frame time
   increment:   increment in seconds

 OUTPUT:
    NetCDF file containing:
      a.) time in modified Julian day
      b.) significant wave height (hs)
      c.) wave direction
      d.) mesh
      e.) peak period
      f.) wave direction
      g.) U10
      h.) V10

 EXAMPLE USAGE
   swan2netcdf('gom1.mat','gom1.nc','gom1','20070101_000000','20070131_000000',3600)
     this converts gom1.mat to gom1.nc using SWAN grid files gom1.ele, gom1.bot
     and gom1.node from Jan 1, 2007 00:00:00 to Jan 31, 2007 00:00:00 in increments
     of 1 hour.

 NOTE
    routine is not refined, e.g. will not check if files exist and will
    probably crash if you do not have the variables above in the SWAN
    output file.
    You will need approximately the following BLOCK command in your SWAN runfile

    BLOCK 'COMPGRID' NOHEAD 'gom1.mat' LAY 3 XP YP DEP HS RTP TPS DIR WLEN &amp;
                WINDV OUTPUT 20070101_000000 3600 SEC

 Author(s):
    Geoff Cowles (University of Massachusetts Dartmouth)
    Eric Holmes (University of Massachusetts Dartmouth)

 Revision history
    09-29-2010 -Now warns you if variable was not found in SWAN output
    .mat file and added two variables from SWAN output Ubot and TmBot.
==============================================================================</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function swan2netcdf(matfile,ncfile,basename,first_time,last_time,increment);</a>
0002 <span class="comment">% Convert a SWAN output file (Matlab) into a NetCDF file</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% function swan2netcdf(matfile,ncfile,basename,first_time,last_time,increment);</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% DESCRIPTION:</span>
0007 <span class="comment">%    read output from unstructured SWAN model (currently 40.82) and</span>
0008 <span class="comment">%    dump to a NetCDF file which is far more useful than a Matlab file.</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% INPUT</span>
0011 <span class="comment">%   matfile  = Unstructured SWAN Matlab file</span>
0012 <span class="comment">%   ncfile   = NetCDF file for output</span>
0013 <span class="comment">%   basename = prefix for SWAN mesh, bathymetry, connectivity files</span>
0014 <span class="comment">%   first_time:  first time frame in Matlab object frame time</span>
0015 <span class="comment">%   last_time:   last time frame in Matlab object frame time</span>
0016 <span class="comment">%   increment:   increment in seconds</span>
0017 <span class="comment">%</span>
0018 <span class="comment">% OUTPUT:</span>
0019 <span class="comment">%    NetCDF file containing:</span>
0020 <span class="comment">%      a.) time in modified Julian day</span>
0021 <span class="comment">%      b.) significant wave height (hs)</span>
0022 <span class="comment">%      c.) wave direction</span>
0023 <span class="comment">%      d.) mesh</span>
0024 <span class="comment">%      e.) peak period</span>
0025 <span class="comment">%      f.) wave direction</span>
0026 <span class="comment">%      g.) U10</span>
0027 <span class="comment">%      h.) V10</span>
0028 <span class="comment">%</span>
0029 <span class="comment">% EXAMPLE USAGE</span>
0030 <span class="comment">%   swan2netcdf('gom1.mat','gom1.nc','gom1','20070101_000000','20070131_000000',3600)</span>
0031 <span class="comment">%     this converts gom1.mat to gom1.nc using SWAN grid files gom1.ele, gom1.bot</span>
0032 <span class="comment">%     and gom1.node from Jan 1, 2007 00:00:00 to Jan 31, 2007 00:00:00 in increments</span>
0033 <span class="comment">%     of 1 hour.</span>
0034 <span class="comment">%</span>
0035 <span class="comment">% NOTE</span>
0036 <span class="comment">%    routine is not refined, e.g. will not check if files exist and will</span>
0037 <span class="comment">%    probably crash if you do not have the variables above in the SWAN</span>
0038 <span class="comment">%    output file.</span>
0039 <span class="comment">%    You will need approximately the following BLOCK command in your SWAN runfile</span>
0040 <span class="comment">%</span>
0041 <span class="comment">%    BLOCK 'COMPGRID' NOHEAD 'gom1.mat' LAY 3 XP YP DEP HS RTP TPS DIR WLEN &amp;</span>
0042 <span class="comment">%                WINDV OUTPUT 20070101_000000 3600 SEC</span>
0043 <span class="comment">%</span>
0044 <span class="comment">% Author(s):</span>
0045 <span class="comment">%    Geoff Cowles (University of Massachusetts Dartmouth)</span>
0046 <span class="comment">%    Eric Holmes (University of Massachusetts Dartmouth)</span>
0047 <span class="comment">%</span>
0048 <span class="comment">% Revision history</span>
0049 <span class="comment">%    09-29-2010 -Now warns you if variable was not found in SWAN output</span>
0050 <span class="comment">%    .mat file and added two variables from SWAN output Ubot and TmBot.</span>
0051 <span class="comment">%==============================================================================</span>
0052 
0053 eval([<span class="string">'load '</span> matfile]);              <span class="comment">% load binary file containing SWAN results</span>
0054 <span class="comment">% obtained using BLOCK command with COMPGRID-set</span>
0055 <span class="comment">% load the connectivity</span>
0056 elefile=[basename <span class="string">'.ele'</span>];
0057 fid = fopen(elefile);                 <span class="comment">% load TRIANGLE element based connectivity file</span>
0058 [nele] = fscanf(fid,<span class="string">'%i'</span>,[1 3]);     <span class="comment">% get number of triangles</span>
0059 jnk = fscanf(fid,<span class="string">'%i'</span>,[4 nele(1)])'; <span class="comment">% get connectivity table</span>
0060 tri = jnk(:,2:4);
0061 
0062 <span class="comment">% load the bathymetry</span>
0063 bathfile=[basename <span class="string">'.bot'</span>];
0064 h = textread(bathfile,<span class="string">'%f\n'</span>);
0065 node = prod(size(h));
0066 
0067 <span class="comment">% check if variable range exists</span>
0068 f = first_time;
0069 l = last_time;
0070 tbeg = datenum(str2num(f(1:4)),str2num(f(5:6)),str2num(f(7:8)),str2num(f(10:11)),str2num(f(12:13)),str2num(f(14:15)));
0071 tend = datenum(str2num(l(1:4)),str2num(l(5:6)),str2num(l(7:8)),str2num(l(10:11)),str2num(l(12:13)),str2num(l(14:15)));
0072 tinc  = increment/(24*3600);
0073 times = tbeg:tinc:tend;
0074 ntimes = prod(size(times));
0075 <span class="keyword">for</span> i=1:ntimes;
0076     <span class="comment">%  datestr(times(i))</span>
0077     date = datestr(times(i),30);
0078     vname = [<span class="string">'Hsig_'</span>,date(1:8),<span class="string">'_'</span>,date(10:15)];
0079     <span class="keyword">if</span>(exist(vname) == 0)
0080         error(<span class="string">'variable frame %s\n does not exist'</span>,vname)
0081     <span class="keyword">end</span>;
0082 <span class="keyword">end</span>;
0083 
0084 
0085 <span class="comment">% dump the netcdf file</span>
0086 nc = netcdf(ncfile, <span class="string">'clobber'</span>);
0087 
0088 
0089 <span class="comment">% dimensions</span>
0090 nc(<span class="string">'nele'</span>) = nele;
0091 nc(<span class="string">'node'</span>) = node;
0092 nc(<span class="string">'three'</span>) = 3;
0093 nc(<span class="string">'time'</span>) = 0;
0094 
0095 <span class="comment">% variables</span>
0096 date = datestr(times(1),30);
0097 
0098 
0099 
0100 nc{<span class="string">'x'</span>} = ncfloat(<span class="string">'node'</span>);
0101 nc{<span class="string">'x'</span>}.long_name = <span class="string">'nodal x-coordinate'</span>;
0102 nc{<span class="string">'x'</span>}.units     = <span class="string">'m'</span>;
0103 
0104 nc{<span class="string">'y'</span>} = ncfloat(<span class="string">'node'</span>);
0105 nc{<span class="string">'y'</span>}.long_name = <span class="string">'nodal y-coordinate'</span>;
0106 nc{<span class="string">'y'</span>}.units     = <span class="string">'m'</span>;
0107 
0108 nc{<span class="string">'h'</span>} = ncfloat(<span class="string">'node'</span>);
0109 nc{<span class="string">'h'</span>}.long_name = <span class="string">'Bathymetry'</span>;
0110 nc{<span class="string">'h'</span>}.units     = <span class="string">'m'</span>;
0111 
0112 nc{<span class="string">'d'</span>} = ncfloat(<span class="string">'time'</span>,<span class="string">'node'</span>);
0113 nc{<span class="string">'d'</span>}.long_name = <span class="string">'Depth'</span>;
0114 nc{<span class="string">'d'</span>}.units     = <span class="string">'m'</span>;
0115 
0116 nc{<span class="string">'nv'</span>} = ncint(<span class="string">'three'</span>,<span class="string">'nele'</span>);
0117 nc{<span class="string">'nv'</span>}.long_name = <span class="string">'nodes surrounding element'</span>;
0118 
0119 nc{<span class="string">'time'</span>} = ncfloat(<span class="string">'time'</span>);
0120 nc{<span class="string">'time'</span>}.long_name = <span class="string">'Modified Julian Day'</span>;
0121 nc{<span class="string">'time'</span>}.units     = <span class="string">'days'</span>;
0122 
0123 vname = [<span class="string">'Hsig_'</span>,date(1:8),<span class="string">'_'</span>,date(10:15)];
0124 <span class="keyword">if</span>(exist(vname) == 0)
0125     warning(<span class="string">'Variable Hsig does not exist not being added to netCDF output'</span>)
0126 <span class="keyword">else</span>
0127     nc{<span class="string">'hs'</span>} = ncfloat(<span class="string">'time'</span>,<span class="string">'node'</span>);
0128     nc{<span class="string">'hs'</span>}.long_name = <span class="string">'Significant Wave Height'</span>;
0129     nc{<span class="string">'hs'</span>}.units     = <span class="string">'m'</span>;
0130 <span class="keyword">end</span>;
0131 
0132 vname = [<span class="string">'Dir_'</span>,date(1:8),<span class="string">'_'</span>,date(10:15)];
0133 <span class="keyword">if</span>(exist(vname) == 0)
0134     warning(<span class="string">'Variable Dir does not exist not being added to netCDF output'</span>)
0135 <span class="keyword">else</span>
0136     nc{<span class="string">'wdir'</span>} = ncfloat(<span class="string">'time'</span>,<span class="string">'node'</span>);
0137     nc{<span class="string">'wdir'</span>}.long_name = <span class="string">'Wave  Direction'</span>;
0138     nc{<span class="string">'wdir'</span>}.units     = <span class="string">'degree'</span>;
0139 <span class="keyword">end</span>;
0140 
0141 vname = [<span class="string">'RTpeak_'</span>,date(1:8),<span class="string">'_'</span>,date(10:15)];
0142 <span class="keyword">if</span>(exist(vname) == 0)
0143     warning(<span class="string">'Variable RTpeak does not exist not being added to netCDF output'</span>)
0144 <span class="keyword">else</span>
0145     nc{<span class="string">'tpeak'</span>} = ncfloat(<span class="string">'time'</span>,<span class="string">'node'</span>);
0146     nc{<span class="string">'tpeak'</span>}.long_name = <span class="string">'Relative Peak Period'</span>;
0147     nc{<span class="string">'tpeak'</span>}.units     = <span class="string">'s'</span>;
0148 <span class="keyword">end</span>;
0149 
0150 vname = [<span class="string">'Windv_x_'</span>,date(1:8),<span class="string">'_'</span>,date(10:15)];
0151 <span class="keyword">if</span>(exist(vname) == 0)
0152     warning(<span class="string">'Variable WindV_x_ does not exist not being added to netCDF output'</span>)
0153 <span class="keyword">else</span>
0154     nc{<span class="string">'U10'</span>} = ncfloat(<span class="string">'time'</span>,<span class="string">'node'</span>);
0155     nc{<span class="string">'U10'</span>}.long_name = <span class="string">'Wind Velocity x-direction'</span>;
0156     nc{<span class="string">'U10'</span>}.units     = <span class="string">'m/s'</span>;
0157 <span class="keyword">end</span>;
0158 
0159 vname = [<span class="string">'Windv_y_'</span>,date(1:8),<span class="string">'_'</span>,date(10:15)];
0160 <span class="keyword">if</span>(exist(vname) == 0)
0161     warning(<span class="string">'Variable WindV_y_ does not exist not being added to netCDF output'</span>)
0162 <span class="keyword">else</span>
0163     nc{<span class="string">'V10'</span>} = ncfloat(<span class="string">'time'</span>,<span class="string">'node'</span>);
0164     nc{<span class="string">'V10'</span>}.long_name = <span class="string">'Wind Velocity y-direction'</span>;
0165     nc{<span class="string">'V10'</span>}.units     = <span class="string">'m/s'</span>;
0166 <span class="keyword">end</span>;
0167 
0168 
0169 vname = [<span class="string">'Ubot_'</span>,date(1:8),<span class="string">'_'</span>,date(10:15)];
0170 <span class="keyword">if</span>(exist(vname) == 0)
0171     warning(<span class="string">'Variable Ubot does not exist not being added to netCDF output'</span>)
0172 <span class="keyword">else</span>
0173     nc{<span class="string">'Ubot'</span>} = ncfloat(<span class="string">'time'</span>,<span class="string">'node'</span>);
0174     nc{<span class="string">'Ubot'</span>}.long_name = <span class="string">'Bottom Orbital Velocity'</span>;
0175     nc{<span class="string">'Ubot'</span>}.units     = <span class="string">'m/s'</span>;
0176 <span class="keyword">end</span>;
0177 
0178 
0179 vname = [<span class="string">'TmBot_'</span>,date(1:8),<span class="string">'_'</span>,date(10:15)];
0180 <span class="keyword">if</span>(exist(vname) == 0)
0181     warning(<span class="string">'Variable TmBot does not exist not being added to netCDF output'</span>)
0182 <span class="keyword">else</span>
0183     nc{<span class="string">'TmBot'</span>} = ncfloat(<span class="string">'time'</span>,<span class="string">'node'</span>);
0184     nc{<span class="string">'TmBot'</span>}.long_name = <span class="string">'Bottom Wave Period'</span>;
0185     nc{<span class="string">'TmBot'</span>}.units     = <span class="string">'s'</span>;
0186 <span class="keyword">end</span>;
0187 
0188 <span class="comment">% static vars</span>
0189 nc{<span class="string">'x'</span>}(:) = Xp;
0190 nc{<span class="string">'y'</span>}(:) = Yp;
0191 nc{<span class="string">'h'</span>}(:) = h;
0192 nc{<span class="string">'nv'</span>}(:,:) = tri';
0193 
0194 <span class="comment">% dump dynamic vars</span>
0195 <span class="keyword">for</span> i=1:ntimes;
0196     
0197     fprintf(<span class="string">'processing time %s\n'</span>,datestr(times(i)));
0198     
0199     
0200     <span class="comment">%time</span>
0201     shift = 678942.;  <span class="comment">% datenum(2010,1,1,0,0,0)-greg2mjulian(2010,1,1,0,0,0);</span>
0202     nc{<span class="string">'time'</span>}(i) = times(i) - shift;
0203     
0204     <span class="comment">%hs</span>
0205     date = datestr(times(i),30);
0206     vname = [<span class="string">'Hsig_'</span>,date(1:8),<span class="string">'_'</span>,date(10:15)];
0207     <span class="keyword">if</span>(exist(vname) == 0)
0208         <span class="comment">%fprintf('variable frame %s\n does not exist',vname)</span>
0209     <span class="keyword">else</span>
0210         nc{<span class="string">'hs'</span>}(i,:) = eval(vname)';
0211     <span class="keyword">end</span>;
0212     
0213     <span class="comment">%tp</span>
0214     date = datestr(times(i),30);
0215     vname = [<span class="string">'RTpeak_'</span>,date(1:8),<span class="string">'_'</span>,date(10:15)];
0216     <span class="keyword">if</span>(exist(vname) == 0)
0217         <span class="comment">%fprintf('variable frame %s\n does not exist',vname)</span>
0218     <span class="keyword">else</span>
0219         nc{<span class="string">'tpeak'</span>}(i,:) = eval(vname)';
0220     <span class="keyword">end</span>;
0221     
0222     
0223     <span class="comment">%depth</span>
0224     date = datestr(times(i),30);
0225     vname = [<span class="string">'Depth_'</span>,date(1:8),<span class="string">'_'</span>,date(10:15)];
0226     <span class="keyword">if</span>(exist(vname) == 0)
0227         <span class="comment">%fprintf('variable frame %s\n does not exist',vname)</span>
0228     <span class="keyword">else</span>
0229         nc{<span class="string">'d'</span>}(i,:) = eval(vname)';
0230     <span class="keyword">end</span>;
0231     
0232     <span class="comment">% wave dir</span>
0233     date = datestr(times(i),30);
0234     vname = [<span class="string">'Dir_'</span>,date(1:8),<span class="string">'_'</span>,date(10:15)];
0235     <span class="keyword">if</span>(exist(vname) == 0)
0236         <span class="comment">%fprintf('variable frame %s\n does not exist',vname)</span>
0237     <span class="keyword">else</span>
0238         nc{<span class="string">'wdir'</span>}(i,:) = eval(vname)';
0239     <span class="keyword">end</span>;
0240     
0241     <span class="comment">% U10</span>
0242     date = datestr(times(i),30);
0243     vname = [<span class="string">'Windv_x_'</span>,date(1:8),<span class="string">'_'</span>,date(10:15)];
0244     <span class="keyword">if</span>(exist(vname) == 0)
0245         <span class="comment">%fprintf('variable frame %s\n does not exist',vname)</span>
0246     <span class="keyword">else</span>
0247         var = eval(vname)';
0248         var(isnan(var)) = 0.0;
0249         nc{<span class="string">'U10'</span>}(i,:) = var;
0250     <span class="keyword">end</span>;
0251     
0252     <span class="comment">% V10</span>
0253     date = datestr(times(i),30);
0254     vname = [<span class="string">'Windv_y_'</span>,date(1:8),<span class="string">'_'</span>,date(10:15)];
0255     <span class="keyword">if</span>(exist(vname) == 0)
0256         <span class="comment">%fprintf('variable frame %s\n does not exist',vname)</span>
0257     <span class="keyword">else</span>
0258         var = eval(vname)';
0259         var(isnan(var)) = 0.0;
0260         nc{<span class="string">'V10'</span>}(i,:) = var';
0261     <span class="keyword">end</span>;
0262     
0263     <span class="comment">% orbital velocity</span>
0264     date = datestr(times(i),30);
0265     vname = [<span class="string">'Ubot_'</span>,date(1:8),<span class="string">'_'</span>,date(10:15)];
0266     <span class="keyword">if</span>(exist(vname) == 0)
0267         <span class="comment">%fprintf('variable frame %s\n does not exist',vname)</span>
0268     <span class="keyword">else</span>
0269         var = eval(vname)';
0270         var(isnan(var)) = 0.0;
0271         nc{<span class="string">'Ubot'</span>}(i,:) = var';
0272     <span class="keyword">end</span>;
0273     
0274     <span class="comment">% bottom wave period</span>
0275     date = datestr(times(i),30);
0276     vname = [<span class="string">'TmBot_'</span>,date(1:8),<span class="string">'_'</span>,date(10:15)];
0277     <span class="keyword">if</span>(exist(vname) == 0)
0278         <span class="comment">%fprintf('variable frame %s\n does not exist',vname)</span>
0279     <span class="keyword">else</span>
0280         var = eval(vname)';
0281         var(isnan(var)) = 0.0;
0282         nc{<span class="string">'TmBot'</span>}(i,:) = var';
0283     <span class="keyword">end</span>;
0284     
0285 <span class="keyword">end</span>;
0286 
0287 
0288 nc = close(nc);</pre></div>
<hr><address>Generated on Tue 09-Nov-2010 13:53:28 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>